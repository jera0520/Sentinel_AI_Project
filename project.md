# Sentinel_AI_Project 분석 보고서

이 문서는 `Sentinel_AI_Project`의 구조와 목적, 주요 구성 요소에 대한 분석 결과를 정리한 것입니다.

## 1. 프로젝트 개요

이 프로젝트는 **공사 현장 안전 관련 객체(안전모, 사람, 쓰러진 사람)를 탐지**하는 것을 목표로 하는 딥러닝 기반의 객체 탐지 시스템입니다.

주요 기능은 다음과 같습니다.
-   **동영상 비교 분석**: 원본 동영상과 화질을 개선(업스케일)한 동영상을 나란히 놓고 객체 탐지 성능을 비교 분석합니다.
-   **커스텀 모델 학습**: Darknet/YOLOv4 프레임워크를 사용하여 '안전모', '사람', '쓰러짐' 등의 클래스를 탐지하는 커스텀 모델을 학습합니다.
-   **데이터 관리**: AI Hub 데이터를 기반으로 학습 및 검증용 데이터셋을 체계적으로 구축하고 관리합니다.

## 2. 디렉토리 구조 및 설명

```
/home/jera/Sentinel_AI_Project/
├── anu_example/            # 동영상 비교 분석 및 객체 탐지 예제 실행 폴더
├── darknet/                # YOLOv4 딥러닝 프레임워크 소스 및 빌드 환경
├── Dataset/                # 모델 학습을 위한 데이터셋 폴더
├── anu_example.zip         # anu_example 디렉토리의 압축 파일
├── hello.txt               # 프로젝트 작업 절차 및 가이드 문서
└── project.md              # (현재 파일) 프로젝트 분석 보고서
```

### 2.1. `anu_example` 디렉토리

동영상(`test.mp4`)을 입력받아 원본과 업스케일된 버전을 비교하며 객체 탐지를 수행하는 메인 애플리케이션이 위치합니다.

-   **`main_scale.py`**: 메인 실행 스크립트. 멀티프로세싱을 통해 영상처리, 객체탐지, 결과표시를 병렬로 수행합니다.
-   **`test.mp4`**: 분석 예제용 동영상 파일입니다.
-   **`lib/`**: `main_scale.py`에서 사용하는 핵심 라이브러리 모음.
    -   `yolov4.py`: YOLOv4 모델 로딩 및 탐지 수행.
    -   `bytracker.py`: ByteTrack 객체 추적 알고리즘 구현.
    -   `upscale_new.py`: `ffmpeg`을 이용한 영상 업스케일링 기능.
    -   `libdarknet.so`: 컴파일된 Darknet 공유 라이브러리.
-   **`model/`**: 객체 탐지에 사용되는 YOLO 모델 파일.
    -   `person5l/`: '사람' 탐지용 모델 파일(`model.cfg`, `model.weights`, `model.names`)이 저장되어 있습니다.
-   **`Yolo_mark/`**: YOLO 학습 데이터 생성을 위한 C++ 기반의 라벨링 도구(GUI) 소스 코드 및 빌드 파일.

### 2.2. `darknet` 디렉토리

AlexeyAB의 YOLOv4 Darknet 리포지토리의 전체 복사본으로, 커스텀 모델을 학습하고 테스트하기 위한 완전한 개발 환경을 제공합니다.

-   **`src/`**: Darknet 프레임워크의 C 소스 코드.
-   **`cfg/`**: `yolov4.cfg` 등 다양한 YOLO 모델의 신경망 구성 파일.
-   **`darknet`**: 컴파일된 Darknet 실행 파일.
-   **`darknet.py`**: 파이썬용 Darknet 래퍼(wrapper).
-   **`Makefile`, `CMakeLists.txt`**: 프레임워크 빌드 및 컴파일을 위한 스크립트.

### 2.3. `Dataset` 디렉토리

모델 학습에 사용되는 데이터셋을 관리합니다.

-   **`Data/Keypoint/`**: 키포인트 기반 데이터셋.
    -   **`1.Training/`**: 학습용 데이터.
    -   **`2.Validation/`**: 검증용 데이터.
    -   각 폴더는 `원천데이터(zip)`와 `라벨링데이터(zip)`로 나뉘어 체계적으로 관리됩니다.

## 3. 핵심 파일

-   **`hello.txt`**: 이 프로젝트의 A to Z를 담고 있는 가장 중요한 가이드 문서입니다. 데이터 수집, 정제, 라벨링, 모델 설정 변경, 학습, 테스트에 이르는 전 과정을 상세한 설명과 셸 명령어 예시와 함께 기록하고 있습니다. 프로젝트를 이해하고 재현하기 위한 핵심적인 역할을 합니다.

## 4. 전체 작업 흐름

`hello.txt`에 기록된 내용을 바탕으로 재구성한 프로젝트의 전체 작업 흐름은 다음과 같습니다.

1.  **데이터 준비**: AI Hub에서 "공사현장 안전장비" 데이터를 다운로드하고, '안전모', '쓰러짐' 등 필요한 클래스만 선별하여 정제합니다.
2.  **라벨링 형식 변환**: `json` 형식의 라벨을 Darknet 학습에 필요한 `txt` 형식으로 변환합니다.
3.  **데이터 라벨링/검수**: `Yolo_mark` 도구를 빌드하고 사용하여 데이터의 라벨을 수정하거나 검수합니다.
4.  **Darknet 설정**: `darknet` 디렉토리에서 커스텀 학습을 위한 `obj.names`, `obj.data`, `train.txt`, `valid.txt` 파일을 생성합니다.
5.  **모델 구성 수정**: `yolov4.cfg` 파일을 복사하여 `yolov4-custom.cfg`를 만들고, 클래스 수, 배치 사이즈 등 학습 파라미터를 수정합니다.
6.  **모델 학습**: 사전 훈련된 가중치를 다운로드한 후, `darknet detector train` 명령어를 통해 커스텀 모델 학습을 시작합니다. (필요시 cuDNN 관련 오류 해결)
7.  **성능 검증**: 학습이 완료된 모델(`_best.weights`)을 사용하여 테스트 이미지로 성능을 확인합니다.
8.  **탐지 시스템 실행**: `anu_example/main_scale.py`를 실행하여 학습된 모델로 실제 영상에서 객체 탐지 및 추적을 수행하고, 업스케일 영상과 비교 분석합니다.
